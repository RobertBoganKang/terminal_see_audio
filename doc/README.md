# 终端查看音频

## 介绍

类似于 `Adobe Audition`，本项目可以帮助我们快速在终端中查看音频信息。 

## 环境要求

Python库可以使用`pip install -r requrements.txt`安装。

终端库：`ffmpeg`, `sox`。

### 图形展示库

这里有几个选项：

* `T-IMG` 功能可以在链接 [timg](https://github.com/hzeller/timg/) 中找到并安装（需要设置`self.plot_command='timg {}'`）；
* `Tterminal Image Viewer (TIV)`功能可以在链接[tiv](https://github.com/stefanhaustein/TerminalImageViewer)找到并安装（默认）；

## 如何使用

一些很简单的命令需要学习。

### 开始

```bash
python see.py <输入文件>
```

* `输入文件`为输入的音频文件路径，文件格式只要程序可识别即可；

### 命令

* `两个数字`：开始时间、结束时间；
  * 例如：`10 20` 的意思是将音频中**10s**到 **20s**的片段切割出来；
* 空字符串 `''`（直接按回车）画出上次结果的图片；
* `p`：播放曾经分析过的音频；
  * `p*`：播放使用`@`、`#`或`^`频谱分析过的音频片段；
* `q`：结束程序；
* `r`重置开始时间、结束时间；
* `m`改变图形展示的 `模式`；一共有几种模式可供选择：
  * `fft`和 `fbank`更改 `y` 轴上的展示方式；
  * `power` 和 `log` 更改颜色渲染的展示方式（频谱图的值变换）；
  * `mono`和`stereo`改变通道数目为`1`或者`非1`（如果原音频通道数不为1）;
  * `spectral`和`phase`：如果通道数为2，`phase`模式将会考虑相位信息；
  * 例如命令： `m fft` 的意思是，将模式改为 `fft` 展示方式；
* `sr`: 更改音频采样率；
  * 例如: `sr 16000` 的意思是变更为 `16000Hz`的采样率；
* `o`：更改输入音频文件路径（路径两端可以接`"`或`'`符号）；
  * 例如：`o demo/june.ogg`或者`o "demo/june.ogg"`的意思是将输入音频更改为`demo/june.ogg`；
* `tmp`：更改临时存放中间文件的文件夹；
* `h`：打印`README.md`文件作为`帮助`；
* `@`或`#`：螺旋、钢琴分析短时频谱；
  * `数字`：`@10`或者`#10`用来分析`10~s`时刻的频谱；
  * `''`：画上次分析的结果螺旋频谱图；
  * 如果`#`命令后面跟两个数字，程序将会画出以这两个数字（开始时间、结束时间）为时间节点的钢琴卷帘图；`#10 20`的意义为画出`10s`到`20s`的钢琴卷帘图片；
  * 命令`##`将会画出上次生成的钢琴卷帘结果；
* `^`：来计算调音频谱峰值频率；
  * `数字`：用命令`^10`来提取`10~s`的调音频率成分，音乐音符名称，和频率尖点强度，以及他们在各个通道的情况（通道`*`代表合并通道，通道`数字`代表不同分通道）；
  * `两个数字`：`开始时间`+`调音频率（Hz）`，然后画调音图；
* `>`：用来播放指定频率的正弦波声音；
  * `数字+Hz`：用来播放指定数字频率的声音；`>440Hz`指播放`440Hz`的音频，`^0 99.041Hz`或`^0 G2+18.31c`来画出`0~s`且在调音频率`99.041Hz`或`G2+18.31c`时的调音图；
  * `音符名`：用来播放该音符名的音频声音；`>a4`指播放`a4`音；`>a4-50c`指播放`a4`音，但比此音低`50`音分；

### 高级命令

* `=`（警告：可能造成程序的严重崩溃）：进行python中的`eval`操作，或者进行python中的 `exec` 操作（进行系统参数赋值）；
  * 例如：`=1+1`来获得答案`2`；
  
  * 例如：`=self.n_window=512`命令可以将系统参数`n_window`设置为`512`；
* `sh`：来执行`shell`命令；
  
  * 例如：`sh echo $PATH`来显示`$PATH`参数；

路径可以自动被填充，其中空格`' '`可被`\s`替代。

## 样例展示

可以使用`./demo/june.ogg`来测试功能。本音频是我演奏的一个钢琴曲 （*柴可夫斯基 - 六月船歌 Op. 37 No. 6*），输入命令即可实现展示：

```bash
python see.py
```

如果想获得更加清晰的图片，请将文字大小调小。